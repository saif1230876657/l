<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Voice Search 3000</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script defer src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <style>
    :root {
      --glass: rgba(255, 255, 255, 0.08);
      --glass-strong: rgba(255, 255, 255, 0.12);
      --neon: #6ee7ff;
      --neon-2: #a78bfa;
    }
    html, body { height: 100%; }
    body {
      background: radial-gradient(1200px 600px at 50% 30%, rgba(80,100,255,.15), transparent 60%), #030314;
      color: #e5f0ff;
      font-family: "Cairo", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow-x: hidden;
    }
    /* 3D canvas behind everything */
    #bg-canvas { position: fixed; inset: 0; z-index: 0; }

    /* Holographic assistant orb */
    .orb {
      width: 160px; height: 160px; border-radius: 9999px;
      background: radial-gradient(circle at 50% 50%, rgba(110,231,255,.5), rgba(167,139,250,.35) 40%, rgba(0,0,0,.2) 60%);
      box-shadow: 0 0 40px 10px rgba(110,231,255,.25), inset 0 0 40px rgba(167,139,250,.35);
      position: relative; isolation: isolate;
    }
    .orb::before, .orb::after {
      content: ""; position: absolute; inset: -18px; border-radius: inherit; filter: blur(12px);
      background: conic-gradient(from 0deg, rgba(110,231,255,.25), rgba(167,139,250,.25), rgba(110,231,255,.25));
      z-index: -1; animation: spin 8s linear infinite;
    }
    .orb::after { inset: -26px; filter: blur(22px); opacity: .4; animation-duration: 16s; }
    @keyframes spin { to { transform: rotate(1turn); } }
    @keyframes pulse { 0%,100%{transform: scale(1);} 30%{transform: scale(1.06);} 60%{transform: scale(0.96);} }
    .orb.listening { animation: pulse 1.4s ease-in-out infinite; box-shadow: 0 0 55px 15px rgba(110,231,255,.35), inset 0 0 55px rgba(167,139,250,.55); }
    .orb.speaking { box-shadow: 0 0 75px 25px rgba(110,231,255,.55), inset 0 0 65px rgba(167,139,250,.75); }

    /* Glowing cards */
    .glow-card {
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      box-shadow: 0 0 0 0 rgba(110,231,255,.0), inset 0 0 0 0 rgba(167,139,250,.0);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    }
    .glow-card:hover {
      transform: translateY(-2px) scale(1.01);
      border-color: rgba(110,231,255,0.45);
      box-shadow: 0 0 35px -10px rgba(110,231,255,.45), inset 0 0 20px -10px rgba(167,139,250,.55);
    }

    /* Floating nav glass bar */
    .glassbar { background: var(--glass); backdrop-filter: blur(14px); border: 1px solid rgba(255,255,255,0.12); }

    /* Hide scrollbars subtle */
    ::-webkit-scrollbar { height: 10px; width: 10px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 9999px; }
    ::-webkit-scrollbar-track { background: transparent; }

    /* Mobile safe area padding */
    .safe { padding-bottom: env(safe-area-inset-bottom); }
  </style>
</head>
<body class="min-h-screen">
  <!-- Three.js Background -->
  <canvas id="bg-canvas" aria-hidden="true"></canvas>

  <!-- Top nav / status -->
  <div class="glassbar fixed top-4 left-1/2 -translate-x-1/2 z-20 w-[min(1100px,94%)] rounded-2xl px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" class="opacity-80">
        <path d="M12 2l3 7h7l-5.6 4.1L18.9 21 12 16.9 5.1 21l2.5-7.9L2 9h7l3-7z" stroke="currentColor" stroke-width="1.2"/>
      </svg>
      <strong class="tracking-wide">AI Voice Search 3000</strong>
      <span id="status-pill" class="ms-2 text-xs px-2 py-0.5 rounded-full border border-white/20">جاهز</span>
    </div>

    <div class="hidden sm:flex items-center gap-2 text-xs opacity-80">
      <span class="px-2 py-1 rounded-lg border border-white/15">قل: <b>ابحث عن</b> …</span>
      <span class="px-2 py-1 rounded-lg border border-white/15">ثم: <b>افتح أول موقع</b></span>
      <span class="px-2 py-1 rounded-lg border border-white/15">أو: <b>اعرض الصور</b> / <b>شغل فيديوهات</b></span>
    </div>
  </div>

  <!-- Main content -->
  <main class="relative z-10 w-[min(1100px,94%)] mx-auto pt-28 pb-28 safe">
    <!-- Assistant + Input Row -->
    <section class="flex flex-col items-center gap-6">
      <div class="orb" id="orb" aria-label="Jarvis-like assistant"></div>

      <!-- Input controls -->
      <div class="w-full flex flex-col sm:flex-row items-stretch gap-3">
        <div class="flex-1 glow-card px-4 py-2 flex items-center gap-2">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="opacity-70">
            <circle cx="11" cy="11" r="8" stroke="currentColor"/>
            <path d="M21 21l-3.5-3.5" stroke="currentColor"/>
          </svg>
          <input id="textQuery" dir="auto" class="bg-transparent flex-1 outline-none placeholder-white/50" placeholder="اكتب هنا… أو قل: ابحث عن الهواتف الجديدة 2025"/>
          <button id="searchBtn" class="text-sm px-3 py-1 rounded-lg border border-white/20 hover:border-white/40 transition">بحث</button>
        </div>
        <button id="micBtn" class="glow-card px-4 py-3 flex items-center justify-center gap-2">
          <svg id="micIcon" width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3z" stroke="currentColor" stroke-width="1.2"/>
            <path d="M19 11a7 7 0 01-14 0" stroke="currentColor" stroke-width="1.2"/>
            <path d="M12 18v4" stroke="currentColor" stroke-width="1.2"/>
          </svg>
          <span class="text-sm">تحدث</span>
        </button>
      </div>

      <!-- Quick actions -->
      <div class="w-full grid grid-cols-2 sm:grid-cols-4 gap-2">
        <button class="glow-card px-3 py-2 text-sm" data-demo="ابحث عن أخبار الذكاء الاصطناعي اليوم">🔎 مثال: ابحث عن أخبار الذكاء الاصطناعي اليوم</button>
        <button class="glow-card px-3 py-2 text-sm" data-demo="ابحث عن أفضل هواتف 2025">📱 مثال: ابحث عن أفضل هواتف 2025</button>
        <button class="glow-card px-3 py-2 text-sm" data-demo="ابحث عن تعلم جافاسكربت للمبتدئين">💡 مثال: تعلم جافاسكربت</button>
        <button class="glow-card px-3 py-2 text-sm" data-demo="ابحث عن مباريات اليوم الدوري الإنجليزي">⚽ مثال: مباريات اليوم</button>
      </div>
    </section>

    <!-- Results -->
    <section class="mt-10">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">النتائج</h2>
        <div class="flex items-center gap-2 text-xs">
          <button id="imagesTab" class="px-3 py-1 rounded-lg border border-white/20 hover:border-white/40 transition">اعرض الصور</button>
          <button id="videosTab" class="px-3 py-1 rounded-lg border border-white/20 hover:border-white/40 transition">شغل فيديوهات</button>
        </div>
      </div>
      <div id="results" class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></div>
      <div id="empty" class="opacity-60 text-center py-10">ابدأ بالقول <b>"ابحث عن ..."</b> أو اكتب كلمات البحث أعلاه.</div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="relative z-10 w-[min(1100px,94%)] mx-auto pb-8 -mt-6 text-xs opacity-70">
    <div class="glassbar rounded-2xl p-3 flex flex-wrap items-center justify-between gap-3">
      <div>يدعم Chrome / Edge / Safari / Firefox (قد تختلف جودة التعرف على الصوت).</div>
      <div>تكامل Google Custom Search API — ضع مفتاحك و CX في الكود.</div>
    </div>
  </footer>

  <script>
    /**********************
     * CONFIG — ضع مفاتيحك هنا
     **********************/
    const GOOGLE_API_KEY = "PUT_YOUR_GOOGLE_CUSTOM_SEARCH_API_KEY_HERE"; // TODO: استبدل
    const GOOGLE_CX = "PUT_YOUR_CUSTOM_SEARCH_ENGINE_CX_HERE"; // TODO: استبدل

    /**********************
     * UI Helpers
     **********************/
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];
    const resultsEl = qs('#results');
    const emptyEl = qs('#empty');
    const statusPill = qs('#status-pill');
    const orb = qs('#orb');
    const micBtn = qs('#micBtn');
    const textQuery = qs('#textQuery');
    const searchBtn = qs('#searchBtn');
    const imagesTab = qs('#imagesTab');
    const videosTab = qs('#videosTab');

    let lastQuery = "";
    let lastResults = [];

    function setStatus(text, tone = 'neutral') {
      statusPill.textContent = text;
      const colors = { neutral: 'border-white/20', ok: 'border-emerald-400/50', warn: 'border-amber-400/50', bad: 'border-rose-400/50'};
      statusPill.className = `ms-2 text-xs px-2 py-0.5 rounded-full border ${colors[tone]||colors.neutral}`;
    }

    function speak(text, lang = 'ar-EG') {
      if (!('speechSynthesis' in window)) return;
      try {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = lang;
        const assignVoice = () => {
          const voices = speechSynthesis.getVoices();
          const ar = voices.find(v => v.lang && v.lang.toLowerCase().startsWith('ar'));
          if (ar) u.voice = ar;
          speechSynthesis.cancel();
          orb.classList.add('speaking');
          speechSynthesis.speak(u);
        };
        if (speechSynthesis.getVoices().length === 0) {
          speechSynthesis.onvoiceschanged = () => assignVoice();
        } else assignVoice();
        u.onend = () => orb.classList.remove('speaking');
      } catch (e) { console.warn(e); }
    }

    function ordinalToIndex(word){
      const map = { 'أول':0, 'اول':0, 'الأول':0, 'الاول':0, 'ثاني':1, 'الثاني':1, 'ثالث':2, 'الثالث':2, 'رابع':3, 'الرابع':3, 'خامس':4, 'الخامس':4, 'سادس':5, 'السادس':5, 'سابع':6, 'السابع':6, 'ثامن':7, 'الثامن':7, 'تاسع':8, 'التاسع':8, 'عاشر':9, 'العاشر':9 };
      if (map[word] !== undefined) return map[word];
      // أرقام عربية وهندية
      const nums = { '٠':0,'١':1,'٢':2,'٣':3,'٤':4,'٥':5,'٦':6,'٧':7,'٨':8,'٩':9 };
      if (/^\d+$/.test(word)) return Math.max(0, parseInt(word,10)-1);
      const replaced = word.split('').map(ch => (nums[ch]??ch)).join('');
      if (/^\d+$/.test(replaced)) return Math.max(0, parseInt(replaced,10)-1);
      return null;
    }

    function renderResults(items = []){
      lastResults = items || [];
      resultsEl.innerHTML = '';
      if (!items || !items.length){ emptyEl.style.display = 'block'; return; }
      emptyEl.style.display = 'none';
      for(const [i,item] of items.entries()){
        const card = document.createElement('article');
        card.className = 'glow-card p-4 flex flex-col gap-3';
        const title = document.createElement('a');
        title.href = item.link; title.target = '_blank';
        title.className = 'font-semibold hover:underline';
        title.textContent = `${i+1}. ${item.title || item.htmlTitle || 'بدون عنوان'}`;

        const snippet = document.createElement('p');
        snippet.className = 'opacity-80 text-sm leading-6';
        snippet.textContent = item.snippet || item.htmlSnippet || '';

        const meta = document.createElement('div');
        meta.className = 'text-xs opacity-60 break-all';
        try { meta.textContent = new URL(item.link).hostname; } catch { meta.textContent = item.link; }

        // صورة معاينة إن وجدت
        if (item.pagemap && item.pagemap.cse_image && item.pagemap.cse_image[0]?.src){
          const img = document.createElement('img');
          img.src = item.pagemap.cse_image[0].src; img.alt = item.title || 'صورة';
          img.loading = 'lazy'; img.referrerPolicy = 'no-referrer';
          img.className = 'w-full aspect-video object-cover rounded-xl border border-white/15';
          card.appendChild(img);
        }

        card.appendChild(title);
        card.appendChild(snippet);
        card.appendChild(meta);
        resultsEl.appendChild(card);
      }
    }

    async function searchGoogle(query){
      if (!GOOGLE_API_KEY || GOOGLE_API_KEY.startsWith('PUT_')){
        setStatus('أدخل مفتاح Google API و CX أولاً', 'warn');
        speak('من فضلك أدخل مفتاح واجهة جوجل وسي آكس أولًا');
        return;
      }
      setStatus('يبحث…', 'neutral');
      try{
        const url = new URL('https://www.googleapis.com/customsearch/v1');
        url.searchParams.set('key', GOOGLE_API_KEY);
        url.searchParams.set('cx', GOOGLE_CX);
        url.searchParams.set('q', query);
        url.searchParams.set('num', '10');
        // تخصيص اللغة
        url.searchParams.set('lr', 'lang_ar');
        const res = await fetch(url.toString());
        if (!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        const items = data.items || [];
        renderResults(items);
        lastQuery = query;
        setStatus('تم — النتائج جاهزة', 'ok');
        speak(`تم العثور على ${items.length} نتيجة لكلمة ${query}`);
      }catch(err){
        console.error(err);
        setStatus('حدث خطأ في البحث', 'bad');
        speak('عذرًا، حدث خطأ أثناء البحث');
      }
    }

    function openGoogleTab(type){
      if (!lastQuery){ speak('من فضلك قل ابحث عن … أولًا'); return; }
      const q = encodeURIComponent(lastQuery);
      let url = `https://www.google.com/search?q=${q}`;
      if (type === 'images') url += '&tbm=isch';
      if (type === 'videos') url += '&tbm=vid';
      window.open(url, '_blank');
      speak(type === 'images' ? 'تم فتح تبويب الصور' : 'تم فتح تبويب الفيديوهات');
    }

    // Voice Recognition
    let recognizing = false;
    let recognition;
    function initRecognition(){
      const R = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!R){ setStatus('متصفحك لا يدعم التعرف على الصوت', 'warn'); return; }
      recognition = new R();
      recognition.lang = 'ar-EG';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => { recognizing = true; orb.classList.add('listening'); setStatus('يستمع…'); };
      recognition.onend = () => { recognizing = false; orb.classList.remove('listening'); setStatus('جاهز'); };
      recognition.onerror = (e) => { setStatus('خطأ في الميكروفون', 'bad'); console.warn(e); };
      recognition.onresult = (e) => {
        const t = e.results[0][0].transcript.trim();
        handleVoiceCommand(t);
      };
    }

    function startListening(){
      if (!recognition) initRecognition();
      if (!recognition) return;
      try{ recognition.start(); }catch{ /* ignore if already running */ }
    }

    function openResultByIndex(idx){
      if (!lastResults.length){ speak('لا توجد نتائج مفتوحة'); return; }
      if (idx == null || isNaN(idx) || idx < 0 || idx >= lastResults.length){ speak('رقم غير صحيح'); return; }
      const link = lastResults[idx]?.link;
      if (!link){ speak('تعذر العثور على الرابط'); return; }
      window.open(link, '_blank');
      speak(`تم فتح الموقع رقم ${idx+1}`);
    }

    function handleVoiceCommand(command){
      const c = command.replace(/[\u064B-\u0652]/g, '').trim(); // remove tashkeel
      textQuery.value = c;
      emptyEl.style.display = 'none';

      // 1) ابحث عن …
      const m1 = c.match(/^(ابحث|ابحس|دوّر|دور)\s+عن\s+(.+)$/i);
      if (m1){ const q = m1[2]; speak(`جاري البحث عن ${q}`); searchGoogle(q); return; }

      // 2) افتح أول/ثاني/… موقع — أو افتح [رقم]
      let m2 = c.match(/^افتح\s+(?:الموقع\s+)?(\S+)\s*(?:موقع)?$/i);
      if (m2){
        const idx = ordinalToIndex(m2[1]);
        if (idx !== null) { openResultByIndex(idx); return; }
        const num = parseInt(m2[1], 10);
        if (!isNaN(num)) { openResultByIndex(num-1); return; }
      }

      // 3) اعرض الصور
      if (/^(اعرض|افتح)\s+الصور$/i.test(c) || (/صور/i.test(c) && /اعرض|افتح/.test(c))) { openGoogleTab('images'); return; }

      // 4) شغل فيديوهات / افتح الفيديوهات
      if (/^(شغل|افتح)\s+(الفيديوهات|فيديوهات)$/i.test(c)) { openGoogleTab('videos'); return; }

      // 5) قل مرحبا للتنشيط
      if (/^(مرحبا|هاي|اهلا)$/i.test(c)) { speak('مرحبًا، كيف أساعدك؟ قل: ابحث عن …'); return; }

      // 6) لو قال "ابحث" بدون "عن"
      const m6 = c.match(/^ابحث\s+(.+)$/i);
      if (m6){ const q = m6[1]; speak(`جاري البحث عن ${q}`); searchGoogle(q); return; }

      // افتراضي: اعتبرها جملة بحث
      speak(`حسنًا، سأبحث عن ${c}`);
      searchGoogle(c);
    }

    // Events
    micBtn.addEventListener('click', () => startListening());
    searchBtn.addEventListener('click', () => {
      const q = textQuery.value.trim(); if (!q) return; searchGoogle(q);
    });
    textQuery.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); const q = textQuery.value.trim(); if (q) searchGoogle(q); }
    });
    imagesTab.addEventListener('click', () => openGoogleTab('images'));
    videosTab.addEventListener('click', () => openGoogleTab('videos'));
    qsa('[data-demo]').forEach(btn => btn.addEventListener('click', () => {
      const q = btn.getAttribute('data-demo'); textQuery.value = q; searchGoogle(q);
    }));

    // Request mic permission early on user gesture (first click on mic)
    micBtn.addEventListener('pointerdown', () => {
      if (!('mediaDevices' in navigator)) return;
      navigator.mediaDevices.getUserMedia({ audio: true }).then(() => {
        setStatus('المايك متاح', 'ok');
      }).catch(() => setStatus('رفض إذن المايك', 'bad'));
    }, { once: true });

    /**********************
     * Three.js Background — Particle Galaxy
     **********************/
    const canvas = document.getElementById('bg-canvas');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, 1, 0.1, 1000);
    camera.position.z = 28;

    const resize = () => {
      const w = window.innerWidth, h = window.innerHeight;
      renderer.setSize(w, h, false);
      camera.aspect = w/h; camera.updateProjectionMatrix();
    };
    window.addEventListener('resize', resize); resize();

    // Particles
    const particles = 2000;
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(particles * 3);
    for (let i=0; i<particles; i++){
      const r = 40 * Math.random();
      const theta = Math.random() * Math.PI * 2;
      const phi = Math.acos(2*Math.random() - 1);
      positions[i*3+0] = r * Math.sin(phi) * Math.cos(theta);
      positions[i*3+1] = r * Math.sin(phi) * Math.sin(theta);
      positions[i*3+2] = r * Math.cos(phi);
    }
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    const material = new THREE.PointsMaterial({ size: 0.06, color: 0x94a3ff });
    const points = new THREE.Points(geometry, material);
    scene.add(points);

    // Subtle neon fog
    scene.fog = new THREE.FogExp2(0x050510, 0.03);

    // Animate
    let t = 0;
    function animate(){
      requestAnimationFrame(animate);
      t += 0.0025;
      points.rotation.y += 0.0008;
      points.rotation.x = Math.sin(t*0.6)*0.08;
      renderer.render(scene, camera);
    }
    animate();

    // Mouse parallax
    window.addEventListener('pointermove', (e) => {
      const x = (e.clientX / window.innerWidth) - 0.5;
      const y = (e.clientY / window.innerHeight) - 0.5;
      camera.position.x = x * 2;
      camera.position.y = -y * 2;
      camera.lookAt(0,0,0);
    });

    // Welcome
    setTimeout(() => speak('مرحبًا بك في إيه آي فويس سيرش ثلاثة آلاف. قل: ابحث عن … ثم قل: افتح أول موقع.'), 600);
  </script>
</body>
</html>
