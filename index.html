<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Voice Search 3000</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script defer src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <style>
    :root {
      --glass: rgba(255, 255, 255, 0.08);
      --neon: #6ee7ff;
    }
    html, body { height: 100%; }
    body {
      background: radial-gradient(1200px 600px at 50% 30%, rgba(80,100,255,.15), transparent 60%), #030314;
      color: #e5f0ff;
      font-family: "Cairo", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow-x: hidden;
    }
    #bg-canvas { position: fixed; inset: 0; z-index: 0; }
    .orb {
      width: 160px; height: 160px; border-radius: 9999px;
      background: radial-gradient(circle at 50% 50%, rgba(110,231,255,.5), rgba(167,139,250,.35) 40%, rgba(0,0,0,.2) 60%);
      box-shadow: 0 0 40px 10px rgba(110,231,255,.25), inset 0 0 40px rgba(167,139,250,.35);
      position: relative; isolation: isolate;
    }
    .orb::before, .orb::after {
      content: ""; position: absolute; inset: -18px; border-radius: inherit; filter: blur(12px);
      background: conic-gradient(from 0deg, rgba(110,231,255,.25), rgba(167,139,250,.25), rgba(110,231,255,.25));
      z-index: -1; animation: spin 8s linear infinite;
    }
    .orb::after { inset: -26px; filter: blur(22px); opacity: .4; animation-duration: 16s; }
    @keyframes spin { to { transform: rotate(1turn); } }
    @keyframes pulse { 0%,100%{transform: scale(1);} 30%{transform: scale(1.06);} 60%{transform: scale(0.96);} }
    .orb.listening { animation: pulse 1.4s ease-in-out infinite; box-shadow: 0 0 55px 15px rgba(110,231,255,.35), inset 0 0 55px rgba(167,139,250,.55); }
    .orb.speaking { box-shadow: 0 0 75px 25px rgba(110,231,255,.55), inset 0 0 65px rgba(167,139,250,.75); }
    .glow-card {
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    }
    .glow-card:hover {
      transform: translateY(-2px) scale(1.01);
      border-color: rgba(110,231,255,0.45);
      box-shadow: 0 0 35px -10px rgba(110,231,255,.45), inset 0 0 20px -10px rgba(167,139,250,.55);
    }
    .glassbar { background: var(--glass); backdrop-filter: blur(14px); border: 1px solid rgba(255,255,255,0.12); }
    ::-webkit-scrollbar { height: 10px; width: 10px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 9999px; }
    ::-webkit-scrollbar-track { background: transparent; }
  </style>
</head>
<body class="min-h-screen">
  <canvas id="bg-canvas" aria-hidden="true"></canvas>

  <div class="glassbar fixed top-4 left-1/2 -translate-x-1/2 z-20 w-[min(1100px,94%)] rounded-2xl px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M12 2l3 7h7l-5.6 4.1L18.9 21 12 16.9 5.1 21l2.5-7.9L2 9h7l3-7z" stroke="currentColor" stroke-width="1.2"/></svg>
      <strong>AI Voice Search 3000</strong>
      <span id="status-pill" class="ms-2 text-xs px-2 py-0.5 rounded-full border border-white/20">جاهز</span>
    </div>
    <div class="hidden sm:flex items-center gap-2 text-xs opacity-80">
      <span>قل: <b>ابحث عن</b> …</span>
      <span>ثم: <b>افتح أول موقع</b></span>
    </div>
  </div>

  <main class="relative z-10 w-[min(1100px,94%)] mx-auto pt-28 pb-28">
    <section class="flex flex-col items-center gap-6">
      <div class="orb" id="orb"></div>
      <div class="w-full flex items-stretch gap-3">
        <div class="flex-1 glow-card px-4 py-2 flex items-center gap-2">
          <input id="textQuery" dir="auto" class="bg-transparent flex-1 outline-none placeholder-white/50" placeholder="اكتب هنا… أو قل: ابحث عن الهواتف الجديدة 2025"/>
          <button id="searchBtn" class="text-sm px-3 py-1 rounded-lg border border-white/20 hover:border-white/40 transition">بحث</button>
        </div>
        <button id="micBtn" class="glow-card px-4 py-3 flex items-center justify-center gap-2">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3z" stroke="currentColor" stroke-width="1.2"/><path d="M19 11a7 7 0 01-14 0" stroke="currentColor" stroke-width="1.2"/><path d="M12 18v4" stroke="currentColor" stroke-width="1.2"/></svg>
        </button>
      </div>
    </section>

    <section class="mt-10">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">النتائج</h2>
        <div class="flex items-center gap-2 text-xs">
          <button id="imagesTab" class="px-3 py-1 rounded-lg border border-white/20 hover:border-white/40 transition">بحث عن صور</button>
          <button id="videosTab" class="px-3 py-1 rounded-lg border border-white/20 hover:border-white/40 transition">بحث عن فيديوهات</button>
        </div>
      </div>
      <div id="results" class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></div>
      <div id="empty" class="opacity-60 text-center py-10">ابدأ بالقول <b>"ابحث عن ..."</b> أو اكتب كلمات البحث أعلاه.</div>
    </section>
  </main>

  <script>
    /**********************
     * CONFIG — تم وضع مفاتيحك هنا
     **********************/
    const GOOGLE_API_KEY = "AIzaSyD1w_DtZ0TyVUOS1LaHDzFD5gYDdXGzxYo";
    const GOOGLE_CX = "750783450e9234b15";

    /**********************
     * UI Helpers
     **********************/
    const qs = (s) => document.querySelector(s);
    const resultsEl = qs('#results');
    const emptyEl = qs('#empty');
    const statusPill = qs('#status-pill');
    const orb = qs('#orb');
    const micBtn = qs('#micBtn');
    const textQuery = qs('#textQuery');
    const searchBtn = qs('#searchBtn');
    const imagesTab = qs('#imagesTab');
    const videosTab = qs('#videosTab');

    let lastQuery = "";
    let lastResults = [];

    function setStatus(text, tone = 'neutral') {
      statusPill.textContent = text;
      const colors = { neutral: 'border-white/20', ok: 'border-emerald-400/50', warn: 'border-amber-400/50', bad: 'border-rose-400/50'};
      statusPill.className = `ms-2 text-xs px-2 py-0.5 rounded-full border ${colors[tone]||colors.neutral}`;
    }

    function speak(text) {
      if (!('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ar-SA';
      speechSynthesis.cancel();
      orb.classList.add('speaking');
      speechSynthesis.speak(u);
      u.onend = () => orb.classList.remove('speaking');
    }

    function ordinalToIndex(word){
      const map = { 'أول':0, 'اول':0, 'الأول':0, 'الاول':0, 'ثاني':1, 'الثاني':1, 'ثالث':2, 'الثالث':2, 'رابع':3, 'الرابع':3 };
      if (map[word] !== undefined) return map[word];
      if (/^\d+$/.test(word)) return Math.max(0, parseInt(word,10)-1);
      return null;
    }

    function renderResults(items = []){
      lastResults = items || [];
      resultsEl.innerHTML = '';
      if (!items || !items.length){ emptyEl.style.display = 'block'; return; }
      emptyEl.style.display = 'none';
      items.forEach((item, i) => {
        const card = document.createElement('article');
        card.className = 'glow-card p-4 flex flex-col gap-3';
        
        if (item.pagemap?.cse_image?.[0]?.src){
          const img = document.createElement('img');
          img.src = item.pagemap.cse_image[0].src;
          img.className = 'w-full aspect-video object-cover rounded-xl border border-white/15';
          card.appendChild(img);
        }

        const title = document.createElement('a');
        title.href = item.link; title.target = '_blank';
        title.className = 'font-semibold hover:underline';
        title.textContent = `${i+1}. ${item.title || 'بدون عنوان'}`;

        const snippet = document.createElement('p');
        snippet.className = 'opacity-80 text-sm leading-6';
        snippet.textContent = item.snippet || '';

        const meta = document.createElement('div');
        meta.className = 'text-xs opacity-60 break-all mt-auto pt-2';
        meta.textContent = new URL(item.link).hostname;

        card.appendChild(title);
        card.appendChild(snippet);
        card.appendChild(meta);
        resultsEl.appendChild(card);
      });
    }

    async function searchGoogle(query){
      setStatus('يبحث…', 'neutral');
      try{
        const url = new URL('https://www.googleapis.com/customsearch/v1');
        url.searchParams.set('key', GOOGLE_API_KEY);
        url.searchParams.set('cx', GOOGLE_CX);
        url.searchParams.set('q', query);
        url.searchParams.set('num', '9');
        const res = await fetch(url.toString());
        if (!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        const items = data.items || [];
        renderResults(items);
        lastQuery = query;
        setStatus('تم — النتائج جاهزة', 'ok');
        speak(`تم العثور على ${items.length} نتيجة`);
      }catch(err){
        console.error(err);
        setStatus('حدث خطأ في البحث', 'bad');
        speak('عذرًا، حدث خطأ أثناء البحث');
      }
    }

    function openGoogleTab(type){
      if (!lastQuery){ speak('من فضلك قل ابحث عن … أولًا'); return; }
      const q = encodeURIComponent(lastQuery);
      let url = `https://www.google.com/search?q=${q}`;
      if (type === 'images') url += '&tbm=isch';
      if (type === 'videos') url += '&tbm=vid';
      window.open(url, '_blank');
      speak(type === 'images' ? 'تم فتح تبويب الصور' : 'تم فتح تبويب الفيديوهات');
    }

    let recognition;
    function initRecognition(){
      const R = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!R){ setStatus('متصفحك لا يدعم التعرف على الصوت', 'warn'); return; }
      recognition = new R();
      recognition.lang = 'ar-EG';
      recognition.onstart = () => { orb.classList.add('listening'); setStatus('يستمع…'); };
      recognition.onend = () => { orb.classList.remove('listening'); setStatus('جاهز'); };
      recognition.onerror = (e) => { setStatus('خطأ في الميكروفون', 'bad'); };
      recognition.onresult = (e) => handleVoiceCommand(e.results[0][0].transcript.trim());
    }

    function openResultByIndex(idx){
      if (!lastResults.length){ speak('لا توجد نتائج لفتحها'); return; }
      if (idx == null || idx < 0 || idx >= lastResults.length){ speak('رقم غير صحيح'); return; }
      const link = lastResults[idx]?.link;
      window.open(link, '_blank');
      speak(`تم فتح الموقع رقم ${idx+1}`);
    }

    function handleVoiceCommand(command){
      textQuery.value = command;
      const mSearch = command.match(/^(ابحث|دور)\s+عن\s+(.+)$/i);
      if (mSearch){ searchGoogle(mSearch[2]); return; }

      const mOpen = command.match(/^افتح\s+(?:الموقع\s+)?(\S+)/i);
      if (mOpen){ openResultByIndex(ordinalToIndex(mOpen[1])); return; }

      if (/^(اعرض|افتح)\s+الصور$/i.test(command)) { openGoogleTab('images'); return; }
      if (/^(شغل|افتح)\s+(الفيديوهات|فيديوهات)$/i.test(command)) { openGoogleTab('videos'); return; }
      
      // Default action: search for the whole command
      searchGoogle(command);
    }

    // Events
    micBtn.addEventListener('click', () => { if (!recognition) initRecognition(); recognition?.start(); });
    searchBtn.addEventListener('click', () => { const q = textQuery.value.trim(); if (q) searchGoogle(q); });
    textQuery.addEventListener('keydown', (e) => { if (e.key === 'Enter') { searchBtn.click(); } });
    imagesTab.addEventListener('click', () => openGoogleTab('images'));
    videosTab.addEventListener('click', () => openGoogleTab('videos'));
    
    // 3D Background
    const canvas = document.getElementById('bg-canvas');
    if (window.THREE) {
      const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, 1, 0.1, 1000);
      camera.position.z = 28;
      const resize = () => {
        const w = window.innerWidth, h = window.innerHeight;
        renderer.setSize(w, h, false);
        camera.aspect = w/h; camera.updateProjectionMatrix();
      };
      window.addEventListener('resize', resize); resize();
      const particles = 2000, geometry = new THREE.BufferGeometry(), positions = new Float32Array(particles * 3);
      for (let i=0; i<particles; i++){
        const r=40*Math.random(), t=Math.random()*Math.PI*2, p=Math.acos(2*Math.random()-1);
        positions[i*3]=r*Math.sin(p)*Math.cos(t); positions[i*3+1]=r*Math.sin(p)*Math.sin(t); positions[i*3+2]=r*Math.cos(p);
      }
      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      scene.add(new THREE.Points(geometry, new THREE.PointsMaterial({ size: 0.06, color: 0x94a3ff })));
      scene.fog = new THREE.FogExp2(0x050510, 0.03);
      (function animate(){ requestAnimationFrame(animate); renderer.render(scene, camera); })();
      window.addEventListener('pointermove', (e) => {
        camera.position.x = ((e.clientX / window.innerWidth) - 0.5) * 2;
        camera.position.y = (-(e.clientY / window.innerHeight) + 0.5) * 2;
        camera.lookAt(0,0,0);
      });
    }

    setTimeout(() => speak('مرحبًا بك. قل: ابحث عن …'), 500);
  </script>
</body>
</html>
